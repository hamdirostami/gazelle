<!DOCTYPE html>
<html xmlns="http://www.w3c.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core" xmlns:g="http://pooyaco.ir/ui">
<h:head>
    <base  href="#{personController.basePath}" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="stylesheet" type="text/css" href="css/layout.css"/>

    <script type="text/javascript" src="js/calendar/jquery.ui.datepicker-cc.js"></script>
    <script type="text/javascript" src="js/calendar/calendar.all.js"></script>
    <script type="text/javascript" src="js/calendar/jquery.ui.datepicker-cc-fa.js"></script>
    <script type="text/javascript" src="js/calendar/jquery.maskedinput.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>

    <title>#{personlabel.PERSON_LIST}</title>

</h:head>
<h:body>
    <h:form id="form">
        <p:growl id="growl" showDetail="true" life="5000"/>
        <p:commandButton process="@this" actionListener="#{personController.clear}" update=":form:personDetail"
                         oncomplete="PF('personDialog').show()" icon="ui-icon-plus" title="#{label.NEW}">
        </p:commandButton>

        <br/><br/>
        <p:dataTable id="personList" var="person" update=":form:personDetail"
                     value="#{personController.personModel.persons}" selectionMode="single" rowKey="#{person.id}"
                     rows="10" paginator="true" paginatorPosition="bottom" rowIndexVar="rowIndex"
                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     currentPageReportTemplate="{currentPage} #{label.FROM} {totalPages}"
                     rowsPerPageTemplate="5,10,15"
                >
            <p:column headerText="#{label.ROW}">
                #{rowIndex+1}
            </p:column>

            <p:column headerText="#{personlabel.FIRST_NAME}">
                <h:outputText value="#{person.firstName}"/>
            </p:column>

            <p:column headerText="#{personlabel.LAST_NAME}">
                <h:outputText value="#{person.lastName}"/>
            </p:column>

            <p:column headerText="#{personlabel.BIRTHDAY}">
                <h:outputText converter="persianDateConverter" value="#{person.birthday}"/>
            </p:column>

            <p:column headerText="#{personlabel.CITY}">
                <h:outputText value="#{person.city.name}"/>
            </p:column>

            <p:column style="width:42px;text-align: center" headerText="#{label.EDIT}">
                <p:commandButton process="@this" update=":form:personDetail" oncomplete="PF('personDialog').show()"
                                 icon="ui-icon-pencil" title="#{label.EDIT}">
                    <f:setPropertyActionListener value="#{person}"
                                                 target="#{personController.personModel.selectedPerson}"/>
                </p:commandButton>
            </p:column>
            <p:column style="width:32px;text-align: center" headerText="#{label.DELETE}">
                <p:commandButton process="@this" oncomplete="PF('deleteDialog').show()" icon="ui-icon-trash"
                                 title="#{label.DELETE}">
                    <f:setPropertyActionListener value="#{person}"
                                                 target="#{personController.personModel.selectedPerson}"/>
                </p:commandButton>
            </p:column>

        </p:dataTable>

        <p:dialog id="personInfoDialog" header="#{personlabel.PERSON_INFO}" widgetVar="personDialog" modal="true"
                  showEffect="fade"
                  hideEffect="fade" resizable="false">
            <p:outputPanel id="personDetail" style="text-align:center;">
                <p:panelGrid styleClass="no-border" columns="2" columnClasses="label,value">

                    <h:outputText value="#{personlabel.FIRST_NAME}"/>
                    <p:inputText value="#{personController.personModel.selectedPerson.firstName}" componentType="text"/>

                    <h:outputText value="#{personlabel.LAST_NAME}"/>
                    <p:inputText value="#{personController.personModel.selectedPerson.lastName}" onkeyup=""/>

                    <h:outputText value="#{personlabel.BIRTHDAY}"/>
                    <p:inputText styleClass="date_picker"  componentType="date"
                                 value="#{personController.personModel.selectedPerson.birthday}"/>

                    <h:outputText value="#{personlabel.CITY}"/>
                    <p:panelGrid styleClass="no-border" columns="2">
                        <p:inputText id="cityName" widgetVar="cityName"
                                     value="#{personController.personModel.selectedPerson.city.name}"/>
                        <p:commandButton value="" icon="ui-icon-extlink" oncomplete="PF('cityDialog').show()">
                        </p:commandButton>
                    </p:panelGrid>

                    <h:outputText value="#{personlabel.ORGANIZATIONAL_UNIT}"/>
                    <g:lov id="orgUnitName"  widgetVar="orgUnitName"  listName="organizationalUnits"
                                 value="#{personController.personModel.selectedPerson.organizationalUnit.name}"/>

                    <p:commandButton value="#{label.SAVE}" action="#{personController.update}" update="growl"
                                     onclick="personInfoDialog.hide();">
                    </p:commandButton>
                    <p:remoteCommand name="openModalDialog" immediate="true" actionListener="#{personController.openModalDialog}"/>

                </p:panelGrid>
            </p:outputPanel>
        </p:dialog>
        <p:dialog modal="true" global="true" showEffect="fade" hideEffect="explode" widgetVar="deleteDialog">

            <p:outputLabel value="#{label.DELETE_CONFIRM}"></p:outputLabel>
            <br></br><br></br>
            <p:commandButton value="#{label.YES}" action="#{personController.delete}"
                             oncomplete="PF('deleteDialog').hide()"
                             styleClass="ui-confirmdialog-yes" icon="ui-icon-check" update=":form:personList,growl"/>
            <p:commandButton value="#{label.NO}" oncomplete="PF('deleteDialog').hide()" styleClass="ui-confirmdialog-no"
                             icon="ui-icon-close"/>
        </p:dialog>
        <p:dialog modal="true" global="true" showEffect="fade" hideEffect="explode" widgetVar="cityDialog"
                  id="cityDialog" width="300">
            <p:dataTable id="cityList" var="selectedCity" value="#{personController.personModel.cities}"
                         selectionMode="single" rowKey="#{selectedCity.id}"
                         rows="10">

                <p:ajax event="rowSelect" listener="#{personController.onCitySelect}"/>

                <p:column headerText="#{personlabel.CITY}">
                    <h:outputText value="#{selectedCity.name}"/>
                </p:column>

                <p:column headerText="#{personlabel.PROVINCE}">
                    <h:outputText value="#{selectedCity.province}"/>
                </p:column>

            </p:dataTable>
            <br/><br/><br/>
            <p:commandButton value="select" oncomplete="PF('cityDialog').hide()" styleClass="ui-confirmdialog-no"
                             icon="ui-icon-close" process="@this" update=":form:cityName"/>

        </p:dialog>
    </h:form>
</h:body>
</html>
